
⚠️ **Warning:** Early alpha software. Use at your own risk, this tool can modify, rename, or delete files, and bugs could damage your sample library. Keep backups and proceed with caution. ⚠️

# SEMPAL

Audio sample triage and collection building tool built with Rust and egui.

---

[![Sample workflow preview](assets/example.gif)](assets/example.gif)

[![Buy Me A Coffee](https://img.buymeacoffee.com/button-api/?text=Buy%20me%20a%20coffee&slug=portalsurfm&button_colour=FFDD00&font_colour=000000&font_family=Inter&outline_colour=000000&coffee_colour=ffffff)](https://buymeacoffee.com/portalsurfm)

## Downloads

- Windows binaries are published on GitHub Releases (Windows only for now).
- Publishing a release triggers a workflow that regenerates `CHANGELOG.md` via `git-cliff` and opens a PR (since `main` is protected).

## Build from source

- Requires Rust (stable toolchain) and `cargo`.
- From the project root: `cargo run --release`.
- Or build once and run the binary: `cargo build --release` then `target/release/sempal`.
- Playback uses your default audio output device.
- Windows (ASIO): If you want to build with ASIO support (or your build fails looking for the ASIO SDK), download the Steinberg ASIO SDK and set `CPAL_ASIO_DIR` to the SDK path (e.g. a folder named `ASIOSDK`) before running `cargo build`/`cargo run`.

## ML model setup (PANNs)

- The app uses a PANNs model (burnpack) and requires the ONNX model to build the burnpack.
- Download + export the model once (Windows PowerShell):
  - `.\scripts\setup_panns.ps1`
- Or with Python directly:
  - `python .\scripts\setup_panns.py`
- By default, this writes to `%APPDATA%\\.sempal\\models`:
  - `panns_cnn14_16k.onnx`
  - `panns_cnn14_16k.bpk`
- Override locations if needed:
  - `SEMPAL_PANNS_ONNX_PATH` for the ONNX path
  - `SEMPAL_MODELS_DIR` for the models directory

## Building the Windows installer bundle

- Build the installer + bundle (from repo root):
  - `.\scripts\build_installer.ps1`
- This script expects the burnpack `panns_cnn14_16k.bpk` to be present (generated by the setup step above) and bundles it under `dist/windows/bundle/models`.

## Code style and linting

- Install tooling once: `rustup component add rustfmt clippy`.
- Format locally: `cargo fmt --all`.
- Check formatting (same as CI): `cargo fmt --all -- --check`.
- Lint locally (same as CI): `cargo clippy --all-targets`.
- CI runs `rustfmt` and `clippy` on every push to `main` and all pull requests.

## Configuration and data

- Each source folder gets a hidden `.sempal_samples.db` that tracks indexed `.wav` files and their tags.
- App files live in a single `.sempal` folder inside your OS config directory:
  - Linux: `$HOME/.config/.sempal/config.json`
  - Windows: `%APPDATA%\\.sempal\\config.json`
  - macOS: `~/Library/Application Support/.sempal/config.json`

## Logging

- Startup initializes console logging and a per-launch log file under the same `.sempal` folder:
  - Linux: `$HOME/.config/.sempal/logs`
  - Windows: `%APPDATA%\\.sempal\\logs`
  - macOS: `~/Library/Application Support/.sempal/logs`
- Log filenames include the launch timestamp, and the 10 most recent files are retained by pruning the oldest.

## Documentation

- [Usage guide](docs/usage.md)
